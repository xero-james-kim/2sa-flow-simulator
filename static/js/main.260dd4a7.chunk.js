(this["webpackJsonp2sa-visual-flow"]=this["webpackJsonp2sa-visual-flow"]||[]).push([[0],{16:function(e,t,i){e.exports=i(30)},21:function(e,t,i){},22:function(e,t,i){},30:function(e,t,i){"use strict";i.r(t);var n=i(0),a=i.n(n),r=i(8),s=i.n(r),o=(i(21),i(22),i(23),i(6)),c=i(10),u=i(4),l=i(2),d=i(1),_={api_push_result_received:function(e){return{id:d.Guid.create().toString(),type:"api_push_result_received",correlation:e._correlation,description:"api result is received",message:"received mobile response",args:e,actions:[{text:"accepted",triggers:[{action:"api_push_result_valid_and_accepted",args:e}]},{text:"old push",triggers:[{action:"api_push_result_stale",args:e}]},{text:"declined",triggers:[{action:"api_push_result_valid_and_declined",args:e}]}]}},api_initial_state:function(e){return{id:d.Guid.create().toString(),type:"api_initial_state",message:"In initial state",actions:[],args:e}},api_push_result_sent:function(e){return{id:d.Guid.create().toString(),type:"api_push_result_sent",description:"api result has been sent",message:"API sent back response to mobile and appended event to ES",delay:300,actions:[],args:e}},api_push_request_received:function(e){return{id:d.Guid.create().toString(),type:"api_push_request_received",correlation:e._correlation,args:e,description:"got the request to send push request from web",message:"sending push notification",actions:[{text:"send push to mobile",triggers:[{action:"mobile_push_received",args:Object(l.a)({},e)},{action:"api_push_request_sent",args:Object(l.a)({},e)},{action:"es_append_event",args:{event:"UserSignInStarted"}}]}]}},api_push_request_sent:function(e){return{id:d.Guid.create().toString(),type:"api_push_request_sent",description:"push sent, waiting for response",message:"API sent back response to mobile and appended event to ES",delay:300,actions:[],args:e}},api_push_result_stale:function(e){return{id:d.Guid.create().toString(),type:"api_push_result_stale",correlation:e._correlation,description:"api result is received",message:"push response from mobile is stale, there are newer pushes pending",args:e,actions:[{text:"send back stale response",triggers:[{action:"mobile_push_is_old",args:e}]}]}},api_push_result_valid_and_declined:function(e){return{id:d.Guid.create().toString(),type:"api_push_result_valid_and_declined",correlation:e._correlation,description:"api result is received",message:"push response from mobile is valid but user declined",args:e,actions:[{text:"send back delined response",triggers:[{action:"mobile_push_decline",args:e},{action:"browser_sign_in_declined",args:e},{action:"es_append_event",args:{event:"UserSignInDeclined"}},{action:"api_push_result_sent",args:{}}]}]}},api_push_result_valid_and_accepted:function(e){return{id:d.Guid.create().toString(),type:"api_push_result_valid_and_accepted",correlation:e._correlation,description:"push response from mobile is valid & user accepted",message:"push response from mobile is valid & user accepted",delay:300,args:e,actions:[{text:"ok",triggers:[{action:"mobile_push_success",args:e},{action:"browser_sign_in_success",args:e},{action:"es_append_event",args:{event:"UserSignInSucceeded"}},{action:"api_push_result_sent",args:{}}]},{text:"simulate failure",triggers:[{action:"mobile_push_success",args:e}]}]}}},p={mobile_push_received:function(e){return{id:d.Guid.create().toString(),type:"mobile_push_received",correlation:e._correlation,message:"Logging in from ".concat(e.deviceName,", ").concat(e.location,". Is this you? "),description:"",actions:[{text:"yes",triggers:[{action:"api_push_result_received",args:Object(l.a)({},e,{userAccepted:!0})},{action:"mobile_push_waiting_for_result",args:Object(l.a)({},e)}]},{text:"no",triggers:[{action:"api_push_result_received",args:Object(l.a)({},e,{userAccepted:!1})},{action:"mobile_push_waiting_for_result",args:Object(l.a)({},e)}]}],args:e}},mobile_initial_state:function(e){return{id:d.Guid.create().toString(),type:"mobile_initial_state",message:"Waiting for input",actions:[]}},mobile_push_waiting_for_result:function(e){return{id:d.Guid.create().toString(),correlation:e._correlation,type:"mobile_push_waiting_for_result",message:"",description:"",actions:[],args:e}},mobile_push_success:function(e){return{id:d.Guid.create().toString(),correlation:e._correlation,type:"mobile_push_success",message:"login successful!",description:"",actions:[],args:e}},mobile_push_is_old:function(e){return{id:d.Guid.create().toString(),correlation:e._correlation,type:"mobile_push_is_old",message:"push is old!",description:"",actions:[],args:e}},mobile_push_decline:function(e){return{id:d.Guid.create().toString(),correlation:e._correlation,type:"mobile_push_decline",message:"login successful!",description:"",actions:[],args:e}}},g={browser_initial_state:function(e){return{id:d.Guid.create().toString(),type:"browser_initial_state",message:"We need to send a push notificaiton to your device to make sure it is really you",actions:[{text:"send push",triggers:[{action:"api_push_request_received",args:Object(l.a)({},e)},{action:"browser_push_sent",args:Object(l.a)({},e)}]}]}},browser_push_sent:function(e){return{id:d.Guid.create().toString(),type:"browser_push_sent",message:"We've sent a push notification to you!",args:e,actions:[{text:"send push",isDisabled:!0,triggers:[{action:"browser_push_ask_resend",args:Object(l.a)({},e)}]}]}},browser_push_ask_resend:function(e){return{id:d.Guid.create().toString(),type:"browser_push_ask_resend",message:"Did you not get the notification?",args:e,actions:[{text:"resend push",isDisabled:!1,triggers:[{action:"api_push_request_received",args:Object(l.a)({},e)},{action:"browser_push_sent",args:Object(l.a)({},e)}]}]}},browser_sign_in_success:function(e){return{id:d.Guid.create().toString(),type:"browser_sign_in_success",message:"Signin Successful!",args:e,actions:[]}},browser_sign_in_declined:function(e){return{id:d.Guid.create().toString(),type:"browser_sign_in_declined",message:"Sign in declined in mobile",args:e,actions:[]}}},m={es_append_event:function(e){return{id:d.Guid.create().toString(),args:e,type:"es_append_event",message:"",description:"",actions:[{text:e.event,triggers:[]}]}},es_initial_state:function(e){return{id:d.Guid.create().toString(),args:e,type:"es_initial_state",message:"",description:"",actions:[]}}},b=Object(l.a)({},g,{},_,{},p,{},m),f={mobile:b.mobile_initial_state({}),browser:b.browser_initial_state({}),api:b.api_initial_state({}),es:b.es_initial_state({}),argEditor:{}},h=Object(c.b)({name:"app",initialState:f,reducers:{act:function(e,t){var i=E(t.payload);i&&(e[i]="es"===i?Object(l.a)({},e[i],{actions:[].concat(Object(u.a)(e[i].actions),Object(u.a)(t.payload.actions))}):Object(l.a)({},t.payload)),e.argEditor=t.payload.args},editArg:function(e,t){var i=t.payload.args;e.argEditor=i}}}),v=h.actions,y=h.reducer,E=function(e){var t=e.type.split("_");return t.length>0&&("mobile"===t[0]||"browser"===t[0]||"api"===t[0]||"es"===t[0])?t[0]:null},w=o.c,S=Object(c.a)({reducer:y}),j=i(5);var O=function(e,t){var i=w((function(t){return t[e]})),a=function(e){var t=Object(n.useRef)();return Object(n.useEffect)((function(){t.current=e}),[e]),t.current}(i);Object(n.useEffect)((function(){var e=x(a,i);for(var n in t){e(n,t[n]||function(e,t){})}}),[a,i])},x=function(e,t){return function(i,n){if("always"===i){if(!e)return void n(e,t);if(e&&e.id!==t.id)return void n(e,t)}e||t.type!==i?e&&e.id!==t.id&&t.type===i&&n(e,t):n(e,t)}},G=function(){var e=Object(o.b)(),t=function(t,i){var n=t.triggers;return function(){n.forEach((function(t){var n=t.action,a=t.args;e(v.act(b[n](Object(l.a)({},a,{_correlation:i}))))}))}};return{dispatchAction:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.correlation,r=(n.delay,e.find((function(e){return e.text===i})));i&&r?t(r,a)():e.length&&t(e[0],a)()},dispatchActionCallback:t}},k=function(){var e=w((function(e){return e.mobile})),t=function(){var e=Object(n.useState)([]),t=Object(j.a)(e,2),i=t[0],a=t[1];return{add:function(e){a([].concat(Object(u.a)(i),[e]))},update:function(e){var t=i.map((function(t){return t.id===e.id?e:t}));a(t)},remove:function(e){var t=i.filter((function(t){return t.id!==e}));a(t)},find:function(e){var t=i.find((function(t){return t.id===e}));if(!t)throw new Error("Cant find item: "+e);return Object(l.a)({},t)},getAll:function(){return i}}}(),i=G().dispatchActionCallback,r=function(e,n){return function(){t.remove(n),i(e,n)()}};return O("mobile",{mobile_push_received:function(){t.add(Object(l.a)({},e,{isLoading:!1,id:e.correlation||""}))}}),a.a.createElement("div",null,a.a.createElement("h2",{className:"title"},"Mobile"),t.getAll().map((function(e){return e.isLoading?a.a.createElement("div",{className:"box"},"loading..."):a.a.createElement("div",{className:"box"},e.message,e.actions.map((function(t){return a.a.createElement("div",null,a.a.createElement("button",{className:"button",onClick:r(t,e.id)},t.text))})))})))},N=function(){var e=Object(n.useState)([]),t=Object(j.a)(e,2),i=t[0],a=t[1];return{addTimeout:function(e,t){var n,r=setTimeout(e,t);n=r,a([].concat(Object(u.a)(i),[n]))},clearTimeouts:function(){return i.forEach(clearTimeout)}}},A=function(){var e=w((function(e){return e.browser})),t=G(),i=t.dispatchAction,n=t.dispatchActionCallback,r=N(),s=r.addTimeout,o=r.clearTimeouts;return O("browser",{browser_push_sent:function(t,n){s((function(){i(e.actions,"send push")}),5e3)},always:function(){o()}}),a.a.createElement("div",null,a.a.createElement("h2",{className:"title"},"Browser"),a.a.createElement("div",{className:"box"},e.message,a.a.createElement("div",null,e.actions.map((function(e){return a.a.createElement("button",{className:"button",onClick:n(e),disabled:e.isDisabled},e.text)})))))},q=function(){var e=w((function(e){return e.api})),t=e.correlation,i=e.actions,r=e.message,s=G(),o=s.dispatchAction,c=s.dispatchActionCallback,u=Object(n.useState)(null),l=Object(j.a)(u,2),_=l[0],p=l[1],g={api_push_result_received:function(e,n){_===t?n.args.userAccepted?o(i,"accepted",{correlation:t}):o(i,"declined",{correlation:t}):(console.log("old push"),o(i,"old push",{correlation:t}))},api_push_request_received:function(){}},m=Object(n.useState)(null),b=Object(j.a)(m,2),f=(b[0],b[1],function(e){return function(){var t=d.Guid.create().toString();p(t),c(e,t)()}});return O("api",g),a.a.createElement("div",null,a.a.createElement("h2",{className:"title"},"API"),a.a.createElement("div",{className:"box"},r,a.a.createElement("div",null,e.actions.map((function(e){return a.a.createElement("button",{className:"button",onClick:f(e)},e.text)})))))},I=function(){var e=w((function(e){return e.es}));return a.a.createElement("div",null,a.a.createElement("h2",{className:"title"},"Eventstore"),e.actions.map((function(e){return a.a.createElement("div",null,e.text)})))},C=function(){return a.a.createElement("div",{className:"columns",style:{margin:"20px"}},a.a.createElement("div",{className:"column"},a.a.createElement(A,null)),a.a.createElement("div",{className:"column"},a.a.createElement(k,null)),a.a.createElement("div",{className:"column"},a.a.createElement(q,null)),a.a.createElement("div",{className:"column"},a.a.createElement(I,null)))};var T=function(){return a.a.createElement(o.a,{store:S},a.a.createElement(C,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(a.a.createElement(a.a.StrictMode,null,a.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[16,1,2]]]);
//# sourceMappingURL=main.260dd4a7.chunk.js.map